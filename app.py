<merged and working app.py with all features>